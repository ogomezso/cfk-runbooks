# Internal Autogenerated Cert, External CA signed Certs, LDAP RBAC Authorization and Static Host Based Ingress controller External Access
[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/README.md)
[![es](https://img.shields.io/badge/lang-es-yellow.svg)](https://github.com/ogomezso/cfk-runbooks/blob/main/ussescases/IntAutoTLS-ExtTLS-RBAC-Ingress/README.es.md)

On this use case we gonna implement:

- Internal communication (beetween Confluent Components) secured by simple TLS with autogenerated certs
- External communication (beetween non Confluent clients and CFK cluster) secured by simplpe TLS with certificated signed by a external ca certificates through Ingress Controller
- RBAC Authotization Implemented with LDAP as backend
- Inter-broker (REPLICATION Listener) authentication will use SASL_SSL Plain mechanism (avoiding LDAP dependency for cluster health)
- Confluent Clients (schema registry, connect, etc) will use oauth bearer (MDS) authentication.
- Internal authentication (INTERNAL Listener) using LDAP (for internal K8s clients such a microservices)
- External authentication (EXTERNAL Listener) using LDAP (for non K8s cluster clients)

## Certificates

Fist step will be prepare the certificates we will use on our installation.
Refer to  [Certs](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/0.certs/README.md) section.

## Secrets

Prepare the secrets we will need for `CFK whole installation`. 

Refer to  [Secrets](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/1.secrets/README.md) section.

## Ingress

Refer to the [Ingress Controller section](https://github.com/ogomezso/cfk-runbooks/blob/main/ingress/README.md) to find instruction on how to set up your preferred solution

## Confluent Components

We are going to separate the components resources on several folders and files for better understanding and documentation but if you prefer so you always can keep it on a single file.  

### 1. Zookeeper

We gonna use `autogenerated` certs and digest authentication (JaaS file based auth config).

To apply `zookeeper` cr from project root path:

```bash
kubectl apply -f usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/2.zookeeper/zookeeper.yaml
```

### 2. Brokers

### 3. Schema Registry

### 4. Kafka Connect

### 5. KSQLDB

### 6. Rest Proxy

### 7. Control Center
