# Internal Autogenerated Cert, External CA signed Certs, LDAP RBAC Authorization and Static Host Based Ingress controller External Access
[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/README.md)
[![es](https://img.shields.io/badge/lang-es-yellow.svg)](https://github.com/ogomezso/cfk-runbooks/blob/main/ussescases/IntAutoTLS-ExtTLS-RBAC-Ingress/README.es.md)

En este caso de uso implementaremos:

- Comunicación Interna (entre componentes Confluent) securizada por TLS simple con certificados autofirmados.
- Comunicación Externa (entre clientes no confluent externos al cluster CFK) securizada con TLS simple usando certificados firmados por ca authority externa a través del Ingress Controller
- Autorización RBAC con LDAP como backend
- Inter-broker (REPLICATION Listener) authentication will use SASL_SSL Plain mechanism (avoiding LDAP dependency for cluster health)
- Confluent Clients (schema registry, connect, etc) will use oauth bearer (MDS) authentication.
- Internal authentication (INTERNAL Listener) using LDAP (for internal K8s clients such a microservices)
- External authentication (EXTERNAL Listener) using LDAP (for non K8s cluster clients)

## Certificados

Como primer paso generaremos los certificados necesarios para nuestra instalación.

Más información en la sección [Certs](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/certs/README.es.md).

## Secretos

Preparación de los secretos que necesitaremos para **toda** la instalación

Más información en la sección  [Secrets](https://github.com/ogomezso/cfk-runbooks/blob/main/usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/secrets/README.es.md).

## Ingress

Para resolver el acceso externo al cluster necesitaremos levantar una solución de

En la sección [Ingress Controller](https://github.com/ogomezso/cfk-runbooks/blob/main/ingress/README.md) encontrarás información sobre como levantar algunas de nuestras favoritas.

## Componentes Confluent

Para mayor legibilidad y facilidad de documentación separaremos los recursos en diferentes ficheros.

### 1. Zookeeper

Usaremos certificados autofirmados y autenticación tipo digest (basada en configuración tipo JaaS)

Para aplicar el recurso `zookeeper` ejecutaremos el siguiente comando desde el root del proyecto:

```bash
kubectl apply -f usecases/IntAutoTLS-ExtTLS-RBAC-Ingress/0. certs
```

### 2. Brokers

### 3. Schema Registry

### 4. Kafka Connect

### 5. KSQLDB

### 6. Rest Proxy

### 7. Control Center
